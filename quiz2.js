var easyQuestions = {
  0: {
    question: "This part of the car is one of its most important parts, responsible for the combustion process that gives the entire system life. What is it called?",
    questionUrl: "https://i.pinimg.com/564x/ee/98/09/ee9809621b0304603c99831241e4fe8b.jpg",
    qtype: "qImage",
    choicetype: "cNoImage",
    choices: [
      {
        caption: "Engine",
        right: "yes"
      },
      {
        caption: "Transmission"
      },
      {
        caption: "Gearbox"
      },
      {
        caption: "Combustion Manifold"
      }
    ]
  },
  1: {
    question: "Which one of these is the transmission?",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "cImage",
    choices: [
      {
        url: "https://i.pinimg.com/736x/5b/b8/81/5bb881e0318403b5ba445e8f0401111c.jpg",
        right: "yes"
      },
      {
        url: "https://i.pinimg.com/564x/5f/dc/25/5fdc25f6c8c65b098cf8c4e350c528b0.jpg"
      },
      {
        url: "https://i.pinimg.com/564x/61/3a/1a/613a1a7e8616ff52b03b0c1e7d606701.jpg"
      },
      {
        url: "https://i.pinimg.com/564x/7f/08/05/7f0805b76b7d6e363b6c82bac8867d7b.jpg"
      }
    ]
  },
  2: {
    question: "How many cylinders does a V6 engine have?",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "enum",
    qAns: ["6", "six"]
  },
  3: {
    question: "Which iconic Japanese car is this?",
    questionUrl: "https://i.pinimg.com/564x/4b/67/74/4b67745342eb49dc5c85be11082e1176.jpg",
    qtype: "qImage",
    choicetype: "cNoImage",
    choices: [
      {
        caption: "Toyota Supra",
        right: "yes"
      },
      {
        caption: "Nissan GTR R34"
      },
      {
        caption: "Toyota AE86"
      },
      {
        caption: "Mazda MX-7"
      }
    ]
  },
  4: {
    question: "True or false: Ford is a European car company.",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "tf",
    choices: [
      {
        caption: "False",
        right: "yes"
      },
      {
        caption: "True"
      },
    ]
  },
  5: {
    question: "Most modern Bugattis are powered by what engine?",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "cNoImage",
    choices: [
      {
        caption: "W16 Quad Turbo",
        right: "yes"
      },
      {
        caption: "V12 Twin Turbo"
      },
      {
        caption: "V16 Triple Turbo"
      },
      {
        caption: "W12 Quad Turbo"
      }
    ]
  },
  6: {
    question: "This car brand is most well-known for its cars' iconic red color.",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "cNoImage",
    choices: [
      {
        caption: "Ferrari",
        right: "yes"
      },
      {
        caption: "Porsche"
      },
      {
        caption: "Nissan"
      },
      {
        caption: "Maserati"
      }
    ]
  },
  7: {
    question: "This car is powered by an iconic flat-6 engine.",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "cImage",
    choices: [
      {
        url: "https://i.pinimg.com/564x/53/37/0d/53370d8a4fc590a866da51c036382d17.jpg",
        right: "yes"
      },
      {
        url: "https://i.pinimg.com/564x/b6/f7/9d/b6f79d25c072a5d104acdbfb1307d2f6.jpg"
      },
      {
        url: "https://i.pinimg.com/564x/3f/b9/08/3fb9081b3de76cd297ca667b05b56bec.jpg"
      },
      {
        url: "https://i.pinimg.com/736x/43/a2/61/43a261aa8f039a7546410988db039c2a.jpg"
      }
    ]
  },
  8: {
    question: "Which zodiac features in the logo of Lamborghini?",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "cNoImage",
    choices: [
      {
        caption: "Taurus",
        right: "yes"
      },
      {
        caption: "Gemini"
      },
      {
        caption: "Sagittarius"
      },
      {
        caption: "Pisces"
      }
    ]
  },
  9: {
    question: "How many rings does the Audi logo have?",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "cNoImage",
    choices: [
      {
        caption: "Four",
        right: "yes"
      },
      {
        caption: "Two"
      },
      {
        caption: "Three"
      },
      {
        caption: "The Audi logo has no rings"
      }
    ]
  },
  10: {
    question: "This car is a fairly affordable American muscle car popular among younger customers and is often joked about to crash into places.",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "cImage",
    choices: [
      {
        url: "https://i.pinimg.com/564x/ff/5e/8c/ff5e8c04d5be157517b15ba29faf511d.jpg",
        right: "yes"
      },
      {
        url: "https://i.pinimg.com/564x/a3/0d/4e/a30d4e61320ca31779eb170a137dac89.jpg"
      },
      {
        url: "https://i.pinimg.com/564x/62/a3/88/62a38830699ad7ed96c2d7df49e99081.jpg"
      },
      {
        url: "https://i.pinimg.com/564x/fb/10/e0/fb10e0480a50a4ccd022646d44887bcb.jpg"
      }
    ]
  },
  11: {
    question: "Based on the image, name the car company.",
    questionUrl: "../images/Cars/snippets/e11.png", //https://www.pinterest.ph/pin/357614026674076428/
    qtype: "snippet",
    choicetype: "cNoImage",
    choices: [
      {
        caption: "Mazda",
        right: "yes"
      },
      {
        caption: "Toyota"
      },
      {
        caption: "Nissan"
      },
      {
        caption: "Geely"
      }
    ]
  },
};

var mediumQuestions = {
  0: {
    question: "Which luxury car manufacturer had a history of making jet engines?",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "cNoImage",
    choices: [
      {
        caption: "Rolls-Royce",
        right: "yes"
      },
      {
        caption: "Bentley"
      },
      {
        caption: "Maybach"
      },
      {
        caption: "Mercedes-Benz"
      }
    ]
  },
  1: {
    question: "Which among these is the Ferrari 488 Pista?",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "cImage",
    choices: [
      {
        url: "https://i.pinimg.com/564x/56/fe/fd/56fefd0582c3a1e45920e692d4b6ad54.jpg",
        right: "yes"
      },
      {
        url: "https://i.pinimg.com/736x/3a/f8/72/3af8725761542888a546d6c578f94030.jpg"
      },
      {
        url: "https://i.pinimg.com/564x/49/03/cb/4903cbc0ba90ad212bbca8025f952f32.jpg"
      },
      {
        url: "https://i.pinimg.com/564x/8b/f8/ce/8bf8ce02183538f760593691192f2611.jpg"
      }
    ]
  },
  2: {
    question: "True or False: In a typical internal combustion engine, the camshaft is above the crankshaft",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "tf",
    choices: [
      {
        caption: "True",
        right: "yes"
      },
      {
        caption: "False"
      },
    ]
  },
  3: {
    question: "Name this iconic car that is part of the Holy Trinity. Name it complete with the brand and model name. ",
    questionUrl: "https://i.pinimg.com/564x/63/32/61/6332615ddad3d42ead7f23b329cf2bd3.jpg",
    qtype: "qImage",
    choicetype: "enum",
    qAns: ["porsche918"]
  },
  4: {
    question: "Name this iconic car that is part of the Holy Trinity. Name it complete with the brand and model name.  ",
    questionUrl: "https://i.pinimg.com/564x/d4/5d/01/d45d017a56792096788a07c689611740.jpg",
    qtype: "qImage",
    choicetype: "enum",
    qAns: ["ferrarilaferrari"]
  },
  5: {
    question: "Name this iconic car that is part of the Holy Trinity. Name it complete with the brand and model name.   ",
    questionUrl: "https://i.pinimg.com/564x/28/a4/27/28a4278f6eaafe903fc1fecb08d5398f.jpg",
    qtype: "qImage",
    choicetype: "enum",
    qAns: ["mcLarenp1"]
  },
  6: {
    question: "Based on this snippet, name the car, complete with the brand and model name. ",
    questionUrl: "../images/Cars/snippets/m6.png", //https://i.pinimg.com/564x/9d/78/d2/9d78d232443aa23f277b3f33c55f010d.jpg
    qtype: "snippet",
    choicetype: "enum",
    qAns: ["lamborghiniaventador"]
  },
  7: {
    question: "Which group owns various luxury car brands such as Lamborghini, Audi, Bugatti, Porsche, and Bentley to name a few?",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "cNoImage",
    choices: [
      {
        caption: "Volkswagen",
        right: "yes"
      },
      {
        caption: "Toyota"
      },
      {
        caption: "Ford"
      },
      {
        caption: "Skoda"
      }
    ]
  },
  8: {
    question: "Name this car that was featured in Fast and Furious 7.",
    questionUrl: "https://i.pinimg.com/564x/da/14/c0/da14c0ee841426a9b4dbe2eafb1ce6cc.jpg",
    qtype: "qImage",
    choicetype: "cNoImage",
    choices: [
      {
        caption: "Lykan Hypersport",
        right: "yes"
      },
      {
        caption: "Corvette Stingray"
      },
      {
        caption: "Lamborghini Sian"
      },
      {
        caption: "Bugatti La Voiture Noire"
      }
    ]
  },
  9: {
    question: "Name the company that made this car based on the snippet",
    questionUrl: "../images/Cars/snippets/m9.png", //https://i.pinimg.com/564x/a2/35/1d/a2351dd5c26418d7e2656883f4a72ef5.jpg
    qtype: "snippet",
    choicetype: "enum",
    qAns: ["porsche"]
  },
};

var hardQuestions = {
  0: {
    question: "What is the best selling car of all time?",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "cNoImage",
    choices: [
      {
        caption: "Toyota Corolla",
        right: "yes"
      },
      {
        caption: "Volkswagen Beetle"
      },
      {
        caption: "Ford Model T"
      },
      {
        caption: "Ford F-Series"
      }
    ]
  },
  1: {
    question: "Based on this snippet, name the car, complete with the brand and model name.  ",
    questionUrl: "../images/Cars/snippets/h1.png", //https://i.pinimg.com/564x/44/21/81/4421810807516c0c80d6ec7ea9adcd0a.jpg
    qtype: "snippet",
    choicetype: "enum",
    qAns: ["teslamodelx"]
  },
  2: {
    question: "Based on this snippet, name the car, complete with the brand and model name.   ",
    questionUrl: "../images/Cars/snippets/h2.png", //https://i.pinimg.com/564x/ea/3d/5b/ea3d5b5bd1f636b580babc3e1518c3d8.jpg
    qtype: "snippet",
    choicetype: "enum",
    qAns: ["bmwi8", "bmwieight"]
  },
  3: {
    question: "In what year did Henry Ford establish the Ford Motor Company?",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "enum",
    qAns: ["1903", "nineteentwentythree"]
  },
  4: {
    question: "Completely name the door system found in most Koenigseggs",
    questionUrl: "",
    qtype: "qNoImage",
    choicetype: "enum",
    qAns: ["dihedralsynchrohelix", "dihedralsynchrohelixactuation", "dihedralsynchrohelixactuationdoors", "dihedralsynchrohelixactuationdoor"]
  },

};

var qArray = [easyQuestions, mediumQuestions, hardQuestions]; //declare question arrays
var numArray = [10, 5, 5]; //declare question numbers per array
/* function for starting the quiz */
function startQuiz() {
  const main = document.getElementById("qContainer");
  document.getElementById("startQuiz").style.display = "none";
  document.getElementById("mainQuiz").style.display = "flex";
  
  for (let i = 0; i < 3; i++) {
    var currentArray = qArray[i];
    var currentNum = numArray[i];

    const selectedQuestions = getRandom(currentArray, currentNum);
    
    for (let j = 0; j < selectedQuestions.length; j++) { // for looping each question
      const qDiv = document.createElement("div");
      qDiv.classList.add("question");
      if (i == 0) {
        qDiv.classList.add("easy");
      } else if (i == 1) {
        qDiv.classList.add("medium");
      } else if (i == 2) {
        qDiv.classList.add("hard");
      }
      
      qDiv.innerHTML = "<p>" + currentArray[selectedQuestions[j]].question + "</p>";

      if (currentArray[selectedQuestions[j]].qtype == "qImage") { // if the current question has an image together with the question
        const qImage = document.createElement("img");
        qImage.classList.add("qImage");
        qImage.src = currentArray[selectedQuestions[j]].questionUrl;
        qDiv.appendChild(qImage);
      }
      
      const choices = document.createElement("div");
      if (currentArray[selectedQuestions[j]].choicetype !== "enum") { // to seperate choicetype enum which uses a different approach
      let column;
      for (let k = 0; k < currentArray[selectedQuestions[j]].choices.length; k++) { // for looping each of the choices per question
        if (currentArray[selectedQuestions[j]].qtype == "snippet" && currentArray[selectedQuestions[j]].choicetype == "cNoImage") { // if the choices have no images and is a snippet type question
          const qImage = document.createElement("img");
          qImage.classList.add("snippet");
          qImage.src = currentArray[selectedQuestions[j]].questionUrl;
          if (k == 0) {
            choices.appendChild(qImage);
            column = document.createElement("div");
            column.classList.add("column");
          }
          choices.classList.add("cNoImage");
          const textChoice = document.createElement("div");
          textChoice.classList.add("textChoice");
          textChoice.classList.add("selected");
          textChoice.innerHTML = "<p>" + currentArray[selectedQuestions[j]].choices[k].caption + "</p>";
          column.appendChild(textChoice);
          if (k == 3) {
            choices.appendChild(column);
          }
        }
        
        else if (currentArray[selectedQuestions[j]].choicetype == "cNoImage") { // if the choices have no images but isnt a snippet type
          choices.classList.add("cNoImage");
            if (k == 0 || k == 2) {
              column = document.createElement("div");
              column.classList.add("column");
            }
            const textChoice = document.createElement("div");
            textChoice.classList.add("textChoice");
            textChoice.classList.add("selected");
            textChoice.innerHTML = "<p>" + currentArray[selectedQuestions[j]].choices[k].caption + "</p>";
            if (currentArray[selectedQuestions[j]].choices[k].right == "yes") {
              textChoice.classList.add("right");
            }
            column.appendChild(textChoice);
            if (k == 1 || k == 3) {
              choices.appendChild(column);
            }
        }
        
        else if (currentArray[selectedQuestions[j]].choicetype == "tf") { // if the choices are true or false
          choices.classList.add("tf");
            const textChoice = document.createElement("div");
            textChoice.classList.add("tfChoice");
            textChoice.classList.add("selected");
            textChoice.innerHTML = "<p>" + currentArray[selectedQuestions[j]].choices[k].caption + "</p>";
            if (currentArray[selectedQuestions[j]].choices[k].right == "yes") {
              textChoice.classList.add("right");
            }
          choices.appendChild(textChoice);
        }
          
        else if (currentArray[selectedQuestions[j]].choicetype == "cImage") { // if the choices have images
          choices.classList.add("choices");
            const imgDiv = document.createElement("div");
            imgDiv.classList.add("imgDiv");
            imgDiv.classList.add("selected");
            if (currentArray[selectedQuestions[j]].choices[k].right == "yes") {
              imgDiv.classList.add("right");
            }
            const img = document.createElement("img");
            img.classList.add("image");
            const url = currentArray[selectedQuestions[j]].choices[k].url;
            img.src = url;
            imgDiv.appendChild(img);
            choices.appendChild(imgDiv);
        }
      }
    } else if (currentArray[selectedQuestions[j]].choicetype == "enum" && currentArray[selectedQuestions[j]].qtype !== "snippet") { // if the question is an enumeration type question but has no snippet
      choices.classList.add("enum");
      const input = document.createElement("input");
      input.setAttribute("type", "text");
      input.setAttribute("placeholder", "Answer")
      input.classList.add("questionInput");
      choices.appendChild(input);
    } else if (currentArray[selectedQuestions[j]].qtype == "snippet" && currentArray[selectedQuestions[j]].choicetype == "enum") { // if the question is an enumeration type question but has a snippet
      choices.classList.add("enum");
      choices.style.marginBottom = ".5vw";
      const input = document.createElement("input");
      input.setAttribute("type", "text");
      input.setAttribute("placeholder", "Answer")
      input.style.marginLeft = "1vw";
      input.classList.add("questionInput");
      const parentDiv = document.createElement("div");
      parentDiv.classList.add("cNoImage");
      const imgDiv = document.createElement("div");
      imgDiv.classList.add("snippet");
      const img = document.createElement("img");
      img.src = currentArray[selectedQuestions[j]].questionUrl;
      img.classList.add("snippet");
      imgDiv.appendChild(img);
      parentDiv.appendChild(imgDiv);
      parentDiv.appendChild(input);
      choices.appendChild(parentDiv);
    }
      qDiv.appendChild(choices); 
      main.appendChild(qDiv);
      main.style.display = "block";
      document.getElementById("tradQuiz").style.justifyContent = "flex-start";
    }
  }
  randomizeDivOrder();
  eventListeners();
  randomBgColor();
  document.getElementById("submitQuiz").style.display = "block";
}

/* random numbers generator */
function getRandom(currentArray, currentNum) {
  const questionList = Object.keys(currentArray);
  var selectedQuestions = [];
  var similar;

  /* the loop below randomly selects questions from the questions list */
  for (let i = 0; i < currentNum && questionList.length > 0; i++) {
    var random = Math.floor(Math.random() * questionList.length);
    similar = false;
    for (let j = 0; j < selectedQuestions.length; j++) { //checks for repetition in random numbers
      if (selectedQuestions[j] == random) {
        similar = true;
        break;
      }
    }
    if (similar == false) {
      selectedQuestions.push(random); //if the number was not repeated, it gets pushed into the array
    } else {
      i--; //decrements the loop by 1 if there was a repeated number
    }
  }
  return selectedQuestions;
}

/* function to randomize the div order using Fisher-Yates */
function randomizeDivOrder() {
  const choices = document.querySelectorAll(".choices");
  choices.forEach(choice => { // to randomize the order of all questions with image choices
    const imgDivs = Array.from(choice.querySelectorAll(".imgDiv"));
    for (let i = imgDivs.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      choice.insertBefore(imgDivs[j], imgDivs[i]);
    }
  });
  const cNoImage = document.querySelectorAll(".cNoImage"); 
  cNoImage.forEach(choice => { // to randomize the order of all choices without images
    // if ()
    const column = Array.from(choice.querySelectorAll(".column"));
    if (column.length == 2) {
      column.forEach(column => {
        const random = Math.floor(Math.random() * 2);
        if (random == 1) {
          const textChoice = Array.from(column.querySelectorAll(".textChoice"));
          column.insertBefore(textChoice[1], textChoice[0]);
        }
      });
      const random = Math.floor(Math.random() * 2);
      if (random == 1) {
        choice.insertBefore(column[1], column[0]);
      }
    } else {
    column.forEach(column => {
    const textChoice = Array.from(column.querySelectorAll(".textChoice"));
    for (let i = textChoice.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      column.insertBefore(textChoice[j], textChoice[i]);
    }
  });
  }
  });
  const tf = document.querySelectorAll(".tf"); 
  tf.forEach(tf => { // to randomize the order of all choices that are true or false
    const textChoice = Array.from(tf.querySelectorAll(".tfChoice"));
    const random = Math.floor(Math.random() * 2);
    if (random == 1) {
      tf.insertBefore(textChoice[1], textChoice[0]);
    }
  });
}
/* event listeners for divs so that once a div is clicked, the other three change opacity */
function eventListeners() {
  const parent = document.querySelectorAll(".question");

  parent.forEach((question, index) => {
    const imgChoice = question.querySelectorAll(".choices .imgDiv");
    const noImgChoice = question.querySelectorAll(".cNoImage .textChoice");
    const tf = question.querySelectorAll(".tf .tfChoice");

    imgChoice.forEach(choice => {
      choice.addEventListener("click", () => {
        choice.classList.add("selected");
        choice.classList.remove("deselected");
        imgChoice.forEach(otherChoice => {
          if (otherChoice !== choice) {
            otherChoice.classList.add("deselected");
            otherChoice.classList.remove("selected");
          }
        });
      });
    });

    noImgChoice.forEach(choice => {
      choice.addEventListener("click", () => {
        choice.classList.add("selected");
        choice.classList.remove("deselected");
        noImgChoice.forEach(otherChoice => {
          if (otherChoice !== choice) {
            otherChoice.classList.add("deselected");
            otherChoice.classList.remove("selected");
          }
        });
      });
    });

    tf.forEach(choice => {
      choice.addEventListener("click", () => {
        choice.classList.add("selected");
        choice.classList.remove("deselected");
        tf.forEach(otherChoice => {
          if (otherChoice !== choice) {
            otherChoice.classList.add("deselected");
            otherChoice.classList.remove("selected");
          }
        });
      });
    });

  });
};

/* for assigning each div with a random background color */
function randomBgColor() {
  const colors = ["#FFEBEB", "#ADE4DB", "#6DA9E4", "#F6BA6F", "#C9A7EB", "#6C9BCF", "#AFD3E2", "#ADE4DB", "#FFDEB4", "#FDF7C3", "#FFB4B4", "#EDDBC7", "#FF9494", "#B0DAFF", "#E5BA73", "#FBFACD"];
  const divs = document.querySelectorAll(".question");

  divs.forEach(function(div) {
    const randomColor = colors[Math.floor(Math.random() * colors.length)];
    div.style.backgroundColor = randomColor;
  });
}

/* for checking the completion of inputs */
function checkQuizInput() {
  const questions = document.querySelectorAll(".question");

  if (confirm("Are you sure?")) {
    var found;
    questions.forEach(question => {
      const imgDivs = question.querySelectorAll(".imgDiv");
      const textChoices = question.querySelectorAll(".textChoice");
      const questionInputs = question.querySelectorAll(".questionInput");
      const tfChoices = question.querySelectorAll(".tfChoice");

      if (imgDivs.length > 0) { // for questions with image choices
      if (found) {
        return;
      }
      let selected = 0;
      found = false;

      imgDivs.forEach(imgDiv => {
        if (imgDiv.classList.contains("selected")) {
          selected++;
        }
      });
      if (selected > 1) { //if more than one imgDiv has class "selected" per question, that means that the question has not been answered yet and the script scrolls to that particular question
        alert("Please fill out all questions.");
        question.scrollIntoView({ behavior: "smooth" });
        found = true;
      }
      }

      if (textChoices.length > 0) { // for questions with text choices
        if (found) {
          return;
        }
        let selected = 0;
        found = false;

        textChoices.forEach(choice => {
          if (choice.classList.contains("selected")) {
            selected++;
          }
        });
        if (selected > 1) { //if more than one choice has class "selected" per question, that means that the question has not been answered yet and the script scrolls to that particular question
          alert("Please fill out all questions.");
          question.scrollIntoView({ behavior: "smooth" });
          found = true;
        }
      }

      if (questionInputs.length > 0) { // for questions with enumeration
        if (found) {
          return;
        }
        found = false;

        questionInputs.forEach(input => {
          if (input.value == "") {
            alert("Please fill out all questions.");
            input.scrollIntoView({ behavior: "smooth" });
            found = true;
          }
        });
      }

      if (tfChoices.length > 0) { // for true or false questions
        if (found) {
          return;
        }
        let selected = 0;
        found = false;

        tfChoices.forEach(choice => {
          if (choice.classList.contains("selected")) {
            selected++;
          }
          if (selected > 1) {
            alert("Please fill out all questions.");
            question.scrollIntoView({ behavior: "smooth" });
            found = true;
          }
        });
      }
    
    });
    if (found !== true) { //if all questions are answered, inputs are evaluated
      calculateInput();
    }
  } else {
    return;
  }
}

/* for calculating input values */
var score;

function calculateInput() {
  score = 0;

  const imgDivs = document.querySelectorAll(".imgDiv");
  const textChoices = document.querySelectorAll(".textChoice");
  const questionInputs = document.querySelectorAll(".questionInput");
  const tfChoices = document.querySelectorAll(".tfChoice");

  imgDivs.forEach(imgDiv => {
    if(imgDiv.classList.contains("selected")) {
      if(imgDiv.classList.contains("right")) {
        if(imgDiv.parentElement.parentElement.classList.contains("easy")) {
          score++;
        } else if(imgDiv.parentElement.parentElement.classList.contains("medium")) {
          score++;
          score++;
        } else if(imgDiv.parentElement.parentElement.classList.contains("hard")) {
          score++;
          score++;
          score++;
        }
      }
    }
  });

  textChoices.forEach(textChoice => {
    if(textChoice.classList.contains("selected")) {
      if(textChoice.classList.contains("right")) {
        if(textChoice.parentElement.parentElement.parentElement.classList.contains("easy")) {
          score++;
        } else if(textChoice.parentElement.parentElement.parentElement.classList.contains("medium")) {
          score++;
          score++;
        } else if(textChoice.parentElement.parentElement.parentElement.classList.contains("hard")) {
          score++;
          score++;
          score++;
        }
      }
    }
  });
  
  tfChoices.forEach(tfChoice => {
    if(tfChoice.classList.contains("selected")) {
      if(tfChoice.classList.contains("right")) {
        if(tfChoice.parentElement.parentElement.classList.contains("easy")) {
          score++;
        } else if(tfChoice.parentElement.parentElement.classList.contains("medium")) {
          score++;
          score++;
        } else if(tfChoice.parentElement.parentElement.classList.contains("hard")) {
          score++;
          score++;
          score++;
        }
      }
    }
  });

  questionInputs.forEach(questionInput => {
    var array;
    var index;
    var search;
    var case1 = false;
    var case2 = false;
    var input = questionInput.value;
    var modInput = "";
    if (questionInput.parentElement.parentElement.classList.contains("easy")) {
        array = qArray[0];
        case1 = true;
    } else if (questionInput.parentElement.parentElement.classList.contains("medium")) {
        array = qArray[1];
        case1 = true;
    } else if (questionInput.parentElement.parentElement.classList.contains("hard")) {
        array = qArray[2];
        case1 = true;
    } else if (questionInput.parentElement.parentElement.parentElement.classList.contains("easy")) {
        array = qArray[0];
        case2 = true;
    } else if (questionInput.parentElement.parentElement.parentElement.classList.contains("medium")) {
        array = qArray[1];
        case2 = true;
    } else if (questionInput.parentElement.parentElement.parentElement.classList.contains("hard")) {
        array = qArray[2];
        case2 = true;
    }
    
    if (case1 == true) {
      search = questionInput.parentElement.parentElement.querySelector("p").textContent;
    } else {
      search = questionInput.parentElement.parentElement.parentElement.querySelector("p").textContent;
    }

    for (let i = 0; i < Object.keys(array).length; i++) {
      if (array[i].question == search) {
        index = i;
      }
    }
    
    for (let i = 0; i < input.length; i++) {
      var currentChar = input.charAt(i);
      if (currentChar !== " " && currentChar !== "-") {
        if (!isNaN(currentChar)) {
          modInput += currentChar;
        } else {
          modInput += currentChar.toLowerCase();
        }
      }
    }

    for (let i = 0; i < Object.keys(array[index].qAns).length; i++) {
      if (array[index].qAns[i] == modInput) {
        if (array == qArray[0]) {
          score++;
        } else if (array == qArray[1]) {
          score++;
          score++;
        } else if (array == qArray[2]) {
          score++;
          score++;
          score++;
        }
      }
    }
  });
  displayResult();
}

/* for displaying the result on the page */
function displayResult() {
  document.getElementById("mainQuiz").style.display = "none";
  document.getElementById("results").style.display = "flex";

  // to calculate percentages
  var correctPercent = score / 35;
  var wrongPercent = (35 - score) / 35;

  // chart with chart.js
  const data = {
    labels: ["Correct", "Wrong"],
    datasets: [{
      label: "  You are",
      data: [correctPercent * 100,  wrongPercent * 100],
      backgroundColor: [
        "#19A7CE", "#FF6969"
      ],
      borderWidth: 8,
      borderColor: "rgba(255,255,255,0.8)",
      hoverOffset: 6
    }]
  };

  const config = {
    type: 'doughnut',
    data: data,
    options: {
      borderWidth: 4,
      plugins: {
        tooltip: {
          callbacks: {
            label: function(context) {
              const label = context.dataset.label || " ";
              const value = context.parsed.toFixed(2) + "%";
              const section = context.label || " ";
              return `${label} ${value} ${section}`;
            }
          }
        },
        legend: {
          display: false
        }
      }
    }
  };

  var chart = new Chart(
    document.getElementById("chart"),
    config
  );

  const ul = document.querySelector("ul");
  // making the ul that stands as a legend for the chart

  function populateUl() {
    data.labels.forEach((l, i) => {
      const li = document.createElement("li");
      li.innerHTML = `${l}: <span class="percentage">${data.datasets[0].data[i].toFixed(2)}%</span>`;
      ul.appendChild(li);
    });
  }
  populateUl();

  // displaying more result info
  const heading = ["Car Novice", "Car Enthusiast", "Car Aficionado", "Car Expert", "Car Guru"];
  const description = ["placing you at the rank of Novice. As a curious individual, you have a budding interest in cars. You find yourself drawn to the world of automobiles and have a desire to learn more about different car models, their features, and how they work. You enjoy exploring various resources, such as online articles, videos, and forums, to satisfy your curiosity and expand your knowledge about cars.",
  "placing you at the rank of Enthusiast. Your passion for cars is growing, and you have developed into an enthusiastic car lover. You actively engage with the world of automobiles, following the latest car news, attending car shows, and discussing cars with fellow enthusiasts. You have a good understanding of different car brands, models, and their respective features. You appreciate the artistry and engineering behind automotive design and enjoy discovering the unique characteristics that make each car special.",
  "placing you at the rank of Aficionado. With a wealth of car knowledge, you have become a true aficionado. Your love for cars runs deep, and you possess a comprehensive understanding of the automotive landscape. You have delved into the intricacies of car mechanics, performance, and design, appreciating the interplay between technology and artistry. Your passion extends beyond the surface level, allowing you to engage in discussions about automotive history, significant milestones, and the culture surrounding cars. You may have even developed specialized interests in specific car brands, eras, or niche segments of the automotive world.",
  "placing you at the rank of Expert. You have attained an expert-level status in the realm of car knowledge. Your understanding of cars goes far beyond the average enthusiast, encompassing a profound grasp of technical aspects, historical context, and industry trends. People seek your expertise for advice, insights, and your ability to provide in-depth explanations on complex automotive topics. You may have expertise in specific car manufacturers, technological advancements, or specialized areas.",
  "placing you at the rank of Guru. You are an absolute god of car knowledge. Your expertise in all things automotive is unmatched and highly respected within the community. Your depth of knowledge encompasses not only technical aspects but also a comprehensive understanding of car history, rare and collectible models, and the nuances of car design and performance. You are sought after for your encyclopedic knowledge, ability to provide detailed insights, and your profound understanding of the most intricate details of automotive engineering. Your passion for cars has given you knowledge not a lot of people have, and the topic is something you truly enjoy."
];
  var resH = document.getElementById("resultHeading");
  var resD = document.getElementById("resultDescription");
  var container = document.getElementsByClassName("container")[0];

  document.getElementById("youAre").innerHTML = "You are a...";
  if (score <= 10) {
    resH.innerHTML = heading[0];
    resD.innerHTML = "You got " + score + " /35, " + description[0];
    container.style.backgroundImage = "url('../images/Cars/Novice.jpg')"
  } else if (score <= 20) {
    resH.innerHTML = heading[1];
    resD.innerHTML = "You got " + score + " /35, " + description[1];
    container.style.backgroundImage = "url('../images/Cars/Enthusiast.jpg')"
  } else if (score <= 25) {
    resH.innerHTML = heading[2];
    resD.innerHTML = "You got " + score + " /35, " + description[2];
    container.style.backgroundImage = "url('../images/Cars/Aficionado.jpg')"
  } else if (score <= 30) {
    resH.innerHTML = heading[3];
    resD.innerHTML = "You got " + score + " /35, " + description[3];
    container.style.backgroundImage = "url('../images/Cars/Expert.jpg')"
  } else if (score <= 35) {
    resH.innerHTML = heading[4];
    resD.innerHTML = "You got " + score + " /35, " + description[4];
    container.style.backgroundImage = "url('../images/Cars/Guru.jpg')"
  }

  var historyInitial = document.getElementById("historyInitial");
  var carCont = document.getElementById("rank");
  var carScoreCont = document.getElementById("carScore");

  if (localStorage.getItem("isLoggedIn")) {
    document.getElementById("resetAttemptHistory").style.display = "block";
    let attempts = localStorage.getItem("carAttempts");
    attempts++;
    localStorage.setItem("carAttempts", attempts);
    var saveData = [resH.innerHTML, score];
    localStorage.setItem("carScore" + attempts, JSON.stringify(saveData));
    historyInitial.innerHTML = "View your quiz history below."

    for (let i = 1; i < attempts; i++) {
      const key = "carScore" + i;
      const array = JSON.parse(localStorage.getItem(key));

      const carC = document.createElement("p");
      carC.innerHTML = array[0];
      carCont.appendChild(carC);

      const carPC = document.createElement("p");
      carPC.innerHTML = array[1] + "/35";
      carScoreCont.appendChild(carPC);
    }
  } else {
    historyInitial.innerHTML = "To save the results of your next attempt, sign up or log in."
    carCont.style.display = "none";
    carScoreCont.style.display = "none";
    document.getElementById("resetAttemptHistory").style.display = "none";
  }
}

// to completely reset user attempt history
function resetAttemptHistory() {
  var result = confirm("This will wipe out ALL of your attempt histories, including your current one, for this quiz. This can no longer be undone and your data cannot be recovered. If you would like to do so, please click OK");
  let attempts = localStorage.getItem("carAttempts");
  if (result) {
    for (let i = 1; i <= attempts; i++) {
      const key = "carScore" + i;
      localStorage.removeItem(key);
    }
    attempts = 0;
    localStorage.setItem("carAttempts", 0);
    window.location.reload();
  }
}